some chagnes are done to the code here
